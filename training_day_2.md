```markdown
OroCommerce Training – Day 2 (таймкоды и структура)

**Введение и обзор дня**

00:00:04 – 00:04:00
*   Краткий обзор тем, пройденных в День 1: витрина, настройка веб-сайтов, темы, сущности клиентов и продукты.
*   Упоминание о проблеме с конфигурируемыми продуктами, которая была решена (несоответствие единиц измерения количества между вариантами и конфигурируемым продуктом).
*   Анонс тем Дня 2: Master Catalog, Web Catalog, ценообразование, акции и скидки.

**Master Catalog**

00:05:12 – 00:43:00
*   **Определение:** Master Catalog используется для категоризации продуктов в бэк-офисе, представляя собой древовидную структуру категорий (корневая категория "All Products" и подкатегории).
*   **Свойства категорий:** Каждая категория имеет свои свойства, включая настройки видимости (для клиентов, групп клиентов, веб-сайтов) и опции SEO.
*   **Использование:** Master Catalog может служить источником для главного навигационного меню.
*   **Техническая реализация:** Использует расширение `gedmo/doctrine-extensions` для вложенных деревьев. Сущность, отвечающая за хранение категорий, находится в `Oro\Bundle\CatalogBundle\Entity\Category`.
*   **Демонстрация в бэк-офисе:** Расположение Master Catalog (`Products > Master Catalog`), корневая категория "All Products" и подкатегории (например, "Lightning Products", "Medical").
*   **Настройка категории:** Общая информация (короткое/длинное описание, локализуемые значения), назначение продуктов категории, общие опции продуктов для всей категории (например, настройки инвентаризации, CRM-функции).
*   **Видимость категорий:** Возможность настройки видимости категории на разных уровнях (глобально, для веб-сайта, для группы клиентов, для конкретного клиента) с опциями явного скрытия/отображения или наследования от родительской категории/глобальной конфигурации.
*   **SEO-опции:** Добавление мета-тегов (title, description, keywords) для страниц категорий, которые индексируются поисковыми системами.
*   **Демонстрация видимости:** Скрытие категории "Headlamps" для "Company A" и демонстрация ее недоступности для этого пользователя, но видимости для гостевых пользователей.
*   **Порядок продуктов:** Возможность изменения порядка отображения продуктов в категории.
*   **Поля SEO:** Объяснение, как мета-поля SEO заполняются на странице категории и индексируются для поиска.
*   **Видимость продуктов:** Аналогично категориям, видимость отдельных продуктов может быть настроена на уровнях клиента, группы клиентов и веб-сайта.
*   **Индексация поиска:** Данные продуктов индексируются для поиска (Storefront Index/Frontend Index) асинхронно с использованием потребителей сообщений. Индексы создаются для каждого веб-сайта.
*   **Конфигурация полей поиска:** Файл `website_search.yml` используется для определения полей продукта, доступных для индексации.
*   **Лучшие практики:**
    *   При создании новых атрибутов продуктов заранее определять, должны ли они быть доступными для поиска, фильтрации или сортировки.
    *   Тщательно продумывать структуру семейств продуктов и их атрибутов на ранних этапах проекта, чтобы избежать сложностей при изменении.
    *   Использовать единицы измерения количества только при необходимости, избегая мульти-юнитового режима, если достаточно одной единицы.

**Web Catalog**

00:57:19 – 01:44:19
*   **Определение:** Web Catalog – это инструмент управления контентом, который позволяет персонализировать представление категорий и продуктов для различных пользователей и сценариев (веб-сайт, локализация, группа клиентов).
*   **Отличие от Master Catalog:** Master Catalog – это базовая категоризация продуктов, а Web Catalog – это способ представления этой категоризации на витрине, позволяющий создавать несколько деревьев категорий для разных веб-сайтов.
*   **Создание Web Catalog:** В бэк-офисе (`Marketing > Web Catalogs`) можно создавать несколько веб-каталогов, каждый из которых может быть назначен разным веб-сайтам.
*   **Древовидная структура контента:** Каждый Web Catalog имеет древовидную структуру контентных узлов, которые могут быть использованы для навигации.
*   **Свойства узлов контента:** Каждый узел имеет заголовок, URL-слаг, SEO-опции и ограничения (кто может видеть этот узел).
*   **Назначение Web Catalog веб-сайтам:** Web Catalog может быть назначен глобально или для конкретного веб-сайта в его конфигурации.
*   **Навигационный маршрут:** Можно указать, с какого узла Web Catalog должна начинаться главная навигация на витрине.
*   **Демонстрация ограничений:** Ограничение доступа к узлу "Favorite Products" для "Company A" приводит к его исчезновению из меню и недоступности страницы для этого пользователя.
*   **Варианты контента (Content Variants):** Узлы Web Catalog могут иметь несколько вариантов контента, которые отображаются в зависимости от условий (клиент, группа клиентов, веб-сайт, локализация).
    *   **Типы вариантов:** System Page (системная страница), Product Page (страница продукта), Product Collection (коллекция продуктов), Category (категория Master Catalog), Landing Page (целевая страница).
    *   **Создание пользовательских типов:** Возможность расширения списка типов вариантов контента путем реализации интерфейса `ContentVariantType`.
    *   **System Page:** Отображает системную страницу (например, профиль пользователя).
    *   **Product Page:** Отображает страницу конкретного продукта.
    *   **Product Collection:** Отображает коллекцию продуктов, определенную с помощью сегментов (фильтров).
    *   **Category:** Отображает продукты из указанной категории Master Catalog (с возможностью включения/исключения подкатегорий).
    *   **Landing Page:** Отображает выбранную целевую страницу.
*   **Демонстрация вариантов контента:** Создание двух вариантов для "Favorite Products": Landing Page (по умолчанию) и Product Page (для "Company A").
*   **Различия между Master Catalog и Web Catalog:**
    *   **Количество:** Один Master Catalog против нескольких Web Catalog.
    *   **Ассоциация продуктов:** Продукт принадлежит одной категории Master Catalog, но может быть в нескольких коллекциях Web Catalog.
    *   **Ограничения видимости:** Ограничения Master Catalog влияют на видимость продуктов, а ограничения Web Catalog – на видимость контента.
    *   **Fallback:** Master Catalog имеет механизм fallback для видимости, Web Catalog – нет.
*   **Лучшие практики:**
    *   Использовать Web Catalog для персонализации пользовательского опыта.
    *   Избегать создания коллекций продуктов с огромным количеством товаров в Web Catalog для оптимизации производительности; лучше использовать категории Master Catalog.

**Ценообразование (Pricing)**

01:48:00 – 03:55:50
*   **Гибкое ценообразование:** OroCommerce позволяет устанавливать гибкие цены в зависимости от веб-сайта, группы клиентов или конкретного клиента.
*   **Автоматическое и ручное ценообразование:** Цены могут быть определены вручную или автоматически генерироваться на основе правил.
*   **Расписание цен:** Возможность устанавливать цены на определенный период времени с помощью расписаний.
*   **Компоненты ценообразования:** Валюты, цены продуктов, прайс-листы, атрибуты цен, стратегии ценообразования, механизм расчета цен.
*   **Валюты:**
    *   **Сущность:** Каждая валюта имеет название, код, символ.
    *   **Множество валют:** Enterprise Edition поддерживает несколько валют, Community Edition – одну.
    *   **Курсы обмена:** Возможность указывать курсы обмена между валютами (используются для внутренних целей, не для пересчета цен на витрине).
    *   **Настройка:** В бэк-офисе (`System > Configuration > Currency`) можно добавлять и управлять валютами.
*   **Цены продуктов (Product Prices):**
    *   **Определение:** Цена продукта определяется для конкретного продукта, прайс-листа, количества, единицы измерения и валюты.
    *   **Уникальная комбинация:** Комбинация (продукт, прайс-лист, количество, единица измерения, валюта) должна быть уникальной.
    *   **Многоуровневые цены (Tier Prices):** Цены могут зависеть от количества (например, при покупке 10+ единиц цена ниже).
    *   **Видимость:** Цены отображаются на страницах листинга продуктов, деталях продуктов, в списках покупок и при оформлении заказа.
    *   **Настройка:** Цены могут быть добавлены на странице редактирования продукта или в прайс-листе.
    *   **Импорт:** Возможность импорта цен с помощью CSV-файлов.
*   **Прайс-листы (Price Lists):**
    *   **Типы:** Статические (цены определяются вручную), автогенерируемые (на основе правил), смешанные.
    *   **Свойства:** Название, валюты, активность, расписание, правила назначения продуктов, правила расчета цен.
    *   **Настройка:** В бэк-офисе (`Sales > Price Lists`) можно создавать и управлять прайс-листами.
    *   **Расписание прайс-листов:** Возможность активации прайс-листа на определенный период времени.
    *   **Правила назначения продуктов (Product Assignment Rules):** Определяют, какие продукты должны быть включены в прайс-лист (используют язык выражений Symfony).
    *   **Правила расчета цен (Price Calculation Rules):** Определяют, как рассчитываются цены в прайс-листе (могут использовать статические значения или выражения).
    *   **Пример автогенерации:** Создание прайс-листа, который берет цены из другого прайс-листа и увеличивает их на 10%.
    *   **Пересчет цен:** Цены пересчитываются в фоновом режиме, но есть кнопка для ручного пересчета.
*   **Атрибуты цен (Price Attributes):**
    *   **Определение:** Дополнительные атрибуты, которые могут быть связаны с ценой продукта (например, ERP-цена, рекомендованная розничная цена).
    *   **Настройка:** В бэк-офисе (`Sales > Price Attributes`) можно создавать атрибуты цен.
    *   **Использование:** Значения атрибутов цен могут быть установлены на странице редактирования продукта и затем использованы в правилах расчета цен для автогенерации прайс-листов.
*   **Стратегии ценообразования (Pricing Strategies):**
    *   **Определение:** Определяют, как выбираются окончательные цены, если для одного продукта существует несколько цен на разных уровнях.
    *   **Типы:**
        *   **Minimal:** Выбирается минимальная цена из всех доступных.
        *   **Merge by Priority:** Цены выбираются на основе приоритета уровней (клиент > группа клиентов > веб-сайт > глобальная конфигурация).
    *   **Настройка:** В бэк-офисе (`System > Configuration > Pricing`) можно выбрать стратегию.
*   **Fallback для прайс-листов:** Возможность указать, откуда брать цены, если на текущем уровне они не определены (например, наследовать от веб-сайта, группы клиентов или глобальной конфигурации).
*   **Плоское ценообразование (Flat Pricing):**
    *   **Определение:** Упрощенный режим ценообразования, при котором используется только один прайс-лист, и цены извлекаются напрямую без сложных вычислений.
    *   **Ограничения:** Подходит для небольших компаний, использующих внешние ERP-системы.
    *   **Переключение:** Используется консольная команда `oro:price:storage:switch`.
*   **Лучшие практики:**
    *   Использовать механизм fallback для прайс-листов, чтобы избежать дублирования цен.
    *   Избегать создания отдельных прайс-листов для каждого продукта; лучше группировать продукты.
    *   Минимизировать количество прайс-листов в системе.
    *   Тщательно выбирать стратегию ценообразования на ранних этапах проекта.

**Акции и скидки (Promotions and Discounts)**

03:53:11 – 04:57:10
*   **Цель:** Мотивировать покупателей совершать больше покупок.
*   **Отличие от цен:** Акции применяют специальные цены, а скидки уменьшают существующие цены.
*   **Купоны:** Могут использоваться для применения акций.
*   **Промоакции (Promotions):**
    *   **Сущность:** Каждая промоакция имеет название, порядок сортировки, статус (активна/неактивна), флаг "Stop further rule processing" (останавливает применение других промоакций после срабатывания текущей).
    *   **Триггеры:** Могут срабатывать по условиям или по условиям + купонам.
    *   **Типы скидок:** Order Total (на общую сумму заказа), Order Line Item (на позицию заказа), Buy X Get Y (купи X, получи Y), Shipping (на доставку).
    *   **Расписание:** Возможность активации промоакции на определенный период времени.
    *   **Ограничения:** Промоакции могут быть ограничены для конкретных веб-сайтов, клиентов или групп клиентов, а также с помощью выражений.
    *   **Настройка:** В бэк-офисе (`Marketing > Promotions`) можно создавать и управлять промоакциями.
*   **Типы скидок (Discount Types):**
    *   **Order Total:** Скидка на общую сумму заказа (фиксированная сумма или процент).
    *   **Order Line Item:** Скидка на каждую позицию заказа (фиксированная сумма или процент, может применяться к каждому товару или к общей сумме позиций).
    *   **Buy X Get Y:** Купи X товаров, получи скидку на Y товаров (фиксированная сумма или процент).
    *   **Shipping:** Скидка на стоимость доставки (фиксированная сумма или процент, применяется при выборе определенного метода доставки).
    *   **Пользовательские типы:** Возможность создания собственных типов скидок путем реализации интерфейса `DiscountInterface`.
*   **Купоны (Coupons):**
    *   **Свойства:** Уникальный код, привязка к промоакции, статус (активен/неактивен), количество использований (на купон, на клиента), срок действия.
    *   **Генерация:** Возможность создания одиночных купонов, генерации нескольких купонов (с настройкой длины, типа символов, префикса/суффикса) или импорта с помощью файлов.
    *   **Применение:** Купоны применяются в корзине или при оформлении заказа.
*   **Применение скидок:**
    *   **В корзине:** Скидки на общую сумму заказа и на позиции заказа применяются в корзине.
    *   **При оформлении заказа:** Скидки на доставку применяются на этапе оформления заказа.
    *   **В бэк-офисе:** Возможность вручную добавлять специальные скидки или купоны к уже созданным заказам.
*   **Конфигурация промоакций:**
    *   **Отключение движка промоакций:** Возможность полностью отключить движок промоакций.
    *   **Чувствительность к регистру купонов:** Настройка чувствительности к регистру для кодов купонов.
    *   **Стратегия применения скидок:**
        *   **Combine all discounts:** Применяются все возможные скидки.
        *   **Apply best value discount:** Применяется только скидка с наибольшей выгодой.
*   **Различия между ценами и промоакциями:**
    *   **Видимость:** Цены видны везде (листинг, детали, корзина), промоакции – только в корзине/заказе.
    *   **Применение:** Цены – стандартные, промоакции – для особых условий.
*   **Лучшие практики:**
    *   Использовать прайс-листы для стандартных скидок, применимых ко всем продуктам или группам клиентов.
    *   Использовать промоакции для необычных цен, специфических условий или целевых акций.
    *   Тщательно продумывать стратегию применения скидок (объединять все или применять лучшую).
    *   При создании пользовательских скидок следовать документации и использовать существующие примеры.
```